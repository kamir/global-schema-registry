# Test Scripts - Quick Reference

## ðŸš€ Available Test Scripts

### 1. **run_compatibility_tests.sh** - Complete Test Suite Runner

**What it does:**
- Runs all pytest tests
- Generates HTML, JSON, XML, CSV reports
- Provides code coverage analysis
- Can test against live Schema Registry

**Quick Start:**
```bash
./scripts/run_compatibility_tests.sh
```

**View Results:**
```bash
open test-reports/test-report.html        # Test results
open test-reports/coverage/index.html     # Code coverage
cat test-reports/test-summary.txt         # Summary
```

**Options:**
```bash
# With live Schema Registry testing
SR_URL=http://prod:8081 ./scripts/run_compatibility_tests.sh --live

# Custom report directory
./scripts/run_compatibility_tests.sh --report-dir /tmp/my-reports

# Verbose output
./scripts/run_compatibility_tests.sh --verbose

# Help
./scripts/run_compatibility_tests.sh --help
```

---

### 2. **generate_test_report.py** - Beautiful HTML Report Generator

**What it does:**
- Creates interactive HTML compatibility matrix
- Shows all 49 mode transitions with risk levels
- Provides statistics dashboard
- Exports to JSON

**Quick Start:**
```bash
python3 scripts/generate_test_report.py
open test-reports/compatibility-report.html
```

**Options:**
```bash
# HTML only
python3 scripts/generate_test_report.py --format html

# JSON only
python3 scripts/generate_test_report.py --format json

# Custom output
python3 scripts/generate_test_report.py --output-dir ./my-reports
```

**Report Features:**
- ðŸ“Š 7x7 transition matrix
- ðŸŽ¨ Color-coded risk levels
- ðŸ“ˆ Statistics cards
- ðŸ“ Detailed descriptions
- ðŸ–¨ï¸ Print-friendly

---

### 3. **check_all_topics_compatibility.sh** - Live SR Validator

**Location:** `../MIGRATION-GUIDES/forward-full/scripts/check_all_topics_compatibility.sh`

**What it does:**
- Connects to your actual Schema Registry
- Tests all subjects for target compatibility mode
- Generates CSV reports
- Provides actionable recommendations

**Quick Start:**
```bash
# Check if your schemas are ready for FULL_TRANSITIVE
SCHEMA_REGISTRY_URL=http://localhost:8081 \
TARGET_MODE=FULL_TRANSITIVE \
../MIGRATION-GUIDES/forward-full/scripts/check_all_topics_compatibility.sh
```

**Common Use Cases:**
```bash
# Production readiness check
SR_URL=https://prod-sr.example.com \
TARGET_MODE=FULL_TRANSITIVE \
./check_all_topics_compatibility.sh

# Check for BACKWARD_TRANSITIVE
TARGET_MODE=BACKWARD_TRANSITIVE \
REPORT_FILE=backward_check.csv \
./check_all_topics_compatibility.sh

# Test against Confluent Cloud
SR_URL=https://psrc-xxxxx.us-east-2.aws.confluent.cloud \
SR_KEY=your-key \
SR_SECRET=your-secret \
./check_all_topics_compatibility.sh
```

---

## ðŸ“Š Report Types Generated

| Report Type | Generated By | Location | Use Case |
|-------------|-------------|----------|----------|
| **HTML Test Report** | run_compatibility_tests.sh | test-reports/test-report.html | View test pass/fail results |
| **HTML Compatibility Matrix** | generate_test_report.py | test-reports/compatibility-report.html | Visual transition matrix |
| **JSON Report** | Both scripts | test-reports/*.json | API integration, parsing |
| **CSV Report** | All scripts | test-reports/*.csv | Excel, spreadsheets |
| **Coverage Report** | run_compatibility_tests.sh | test-reports/coverage/ | Code coverage analysis |
| **JUnit XML** | run_compatibility_tests.sh | test-reports/junit.xml | CI/CD integration |

---

## ðŸŽ¯ Common Workflows

### Workflow 1: Development Testing
```bash
# 1. Run tests locally
./scripts/run_compatibility_tests.sh

# 2. Check coverage
open test-reports/coverage/index.html

# 3. Fix failing tests
# ... make changes ...

# 4. Re-run tests
./scripts/run_compatibility_tests.sh
```

### Workflow 2: Pre-Migration Validation
```bash
# 1. Check current production SR
SCHEMA_REGISTRY_URL=https://prod-sr.example.com \
TARGET_MODE=FULL_TRANSITIVE \
../MIGRATION-GUIDES/forward-full/scripts/check_all_topics_compatibility.sh

# 2. Review CSV report
cat schema_FULL_TRANSITIVE_compatibility_report.csv

# 3. Identify incompatible subjects
grep "false" schema_FULL_TRANSITIVE_compatibility_report.csv

# 4. Fix incompatible schemas
# ... update schemas ...

# 5. Re-validate
# ... run check again ...
```

### Workflow 3: Documentation & Reporting
```bash
# 1. Generate beautiful HTML report
python3 scripts/generate_test_report.py

# 2. Share with team
# Email or Slack: test-reports/compatibility-report.html

# 3. Generate JSON for automation
python3 scripts/generate_test_report.py --format json

# 4. Parse JSON programmatically
cat test-reports/compatibility-report.json | jq '.statistics'
```

### Workflow 4: CI/CD Integration
```bash
# In your CI/CD pipeline:

# 1. Run tests
./scripts/run_compatibility_tests.sh

# 2. Upload artifacts
# - test-reports/test-report.html
# - test-reports/junit.xml
# - test-reports/coverage/

# 3. Publish results
# Use junit.xml for test result tracking
```

---

## ðŸ› Troubleshooting

### Scripts won't execute
```bash
chmod +x scripts/*.sh scripts/*.py
```

### Missing dependencies
```bash
pip install -r requirements.txt
pip install pytest pytest-html pytest-json-report pytest-cov
```

### Schema Registry connection fails
```bash
# Test connection
curl http://localhost:8081/subjects

# Check if SR is running
docker ps | grep schema-registry

# Update URL
export SR_URL=http://your-actual-sr:8081
```

### Reports not generated
```bash
# Create directory
mkdir -p test-reports

# Run with verbose
./scripts/run_compatibility_tests.sh --verbose
```

---

## ðŸ“š Documentation

- **[TESTING_GUIDE.md](../docs/TESTING_GUIDE.md)** - Complete testing guide
- **[COMPATIBILITY_MODES_GUIDE.md](../docs/COMPATIBILITY_MODES_GUIDE.md)** - All compatibility modes explained
- **[GETTING_STARTED.md](../GETTING_STARTED.md)** - Quick start guide

---

## âœ… Quick Checklist

Before running tests:
- [ ] Python 3.10+ installed
- [ ] Dependencies installed (`pip install -r requirements.txt`)
- [ ] Scripts are executable
- [ ] Schema Registry accessible (for live tests)
- [ ] Report directory exists or will be created

After running tests:
- [ ] All tests passed
- [ ] Coverage is acceptable (>80%)
- [ ] Reports reviewed
- [ ] Issues documented
- [ ] Next steps identified

---

**Quick Help:**
```bash
# Show all available options
./scripts/run_compatibility_tests.sh --help

# Run everything with defaults (recommended first run)
./scripts/run_compatibility_tests.sh

# Generate standalone visual report
python3 scripts/generate_test_report.py
```
